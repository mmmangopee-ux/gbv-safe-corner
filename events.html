<!DOCTYPE html>
<html>
<head>
    <title>Events & Marches - GBV Safe Corner</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#6A0DAD">
    
    <!-- ANALYTICS INTEGRATED -->
    <script src="analytics.js"></script>
    <script src="navigation.js"></script>
    <script src="supabase-config.js"></script>
    
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            font-family: Arial, sans-serif; 
            max-width: 900px; 
            margin: 0 auto; 
            padding: 20px; 
            background-color: #f8f8f8; 
            line-height: 1.6; 
        }
        .header { 
            background: linear-gradient(135deg, #6A0DAD, #8A2BE2);
            color: white; 
            padding: 30px; 
            text-align: center; 
            border-radius: 15px; 
            margin-bottom: 20px; 
        }
        .logo-text {
            font-size: 2em;
            font-weight: bold;
            text-align: center;
            line-height: 1.2;
            margin-bottom: 10px;
        }
        .logo-text span {
            display: block;
        }
        
        .content-section { 
            background: white; 
            padding: 30px; 
            border-radius: 15px; 
            margin: 25px 0; 
            box-shadow: 0 4px 8px rgba(106, 13, 173, 0.1);
        }
        .event-card { 
            background: #f9f9f9; 
            padding: 25px; 
            margin: 20px 0; 
            border-radius: 12px; 
            border-left: 5px solid #6A0DAD; 
            transition: all 0.3s ease;
            position: relative;
        }
        .event-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(106, 13, 173, 0.15);
        }
        .event-card.upcoming {
            border-left-color: #4CAF50;
            background: linear-gradient(135deg, #f9f9f9, #e8f5e8);
        }
        .event-card.past {
            border-left-color: #666;
            background: linear-gradient(135deg, #f9f9f9, #f0f0f0);
            opacity: 0.8;
        }
        .event-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
        }
        .badge-upcoming {
            background: #4CAF50;
            color: white;
        }
        .badge-past {
            background: #666;
            color: white;
        }
        .organize-box { 
            background: #E8F4FD; 
            padding: 30px; 
            border-radius: 12px; 
            margin: 25px 0; 
            text-align: center; 
            border: 2px dashed #6A0DAD;
        }
        .event-form { 
            background: #f9f9f9; 
            padding: 25px; 
            border-radius: 10px; 
            margin: 20px 0; 
        }
        .form-group { 
            margin: 15px 0; 
        }
        label { 
            display: block; 
            margin-bottom: 5px; 
            font-weight: bold; 
            color: #6A0DAD;
        }
        textarea, select, input { 
            width: 100%; 
            padding: 12px; 
            border: 2px solid #e0e0e0; 
            border-radius: 8px; 
            font-family: Arial; 
            font-size: 16px;
            transition: all 0.3s ease;
        }
        textarea:focus, select:focus, input:focus {
            border-color: #6A0DAD;
            outline: none;
            box-shadow: 0 0 0 3px rgba(106, 13, 173, 0.1);
        }
        .submit-btn { 
            background: #6A0DAD; 
            color: white; 
            padding: 15px 40px; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            font-size: 18px; 
            font-weight: bold;
            transition: all 0.3s ease;
            border: 2px solid #6A0DAD;
        }
        .submit-btn:hover {
            background: #8A2BE2;
            border-color: #8A2BE2;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(106, 13, 173, 0.3);
        }
        .event-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        .action-btn {
            padding: 8px 16px;
            border: 2px solid #6A0DAD;
            background: white;
            color: #6A0DAD;
            border-radius: 6px;
            text-decoration: none;
            font-weight: bold;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .action-btn:hover {
            background: #6A0DAD;
            color: white;
            transform: translateY(-1px);
        }
        .calendar-view {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }
        .calendar-month {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .filter-buttons {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .filter-btn {
            padding: 8px 16px;
            border: 2px solid #6A0DAD;
            background: white;
            color: #6A0DAD;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }
        .filter-btn.active {
            background: #6A0DAD;
            color: white;
        }
        .filter-btn:hover {
            background: #6A0DAD;
            color: white;
        }
        
        /* Enhanced Emergency Exit */
        .emergency-exit {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 10000;
        }
        .emergency-exit-btn {
            background: #FF6B6B;
            color: white;
            padding: 12px 18px;
            border: none;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(255,0,0,0.4);
            font-size: 14px;
            transition: all 0.3s ease;
        }
        .emergency-exit-btn:hover {
            background: #ff5252;
            transform: scale(1.05);
            box-shadow: 0 6px 15px rgba(255,0,0,0.5);
        }
        
        /* Language Selector */
        #languageSelector {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
            padding: 8px 12px;
            border-radius: 5px;
            border: 2px solid #6A0DAD;
            background: white;
            color: #6A0DAD;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        #languageSelector:hover {
            background: #6A0DAD;
            color: white;
        }
        
        /* Accessibility */
        :focus {
            outline: 3px solid #6A0DAD;
            outline-offset: 2px;
        }

        /* Loading and Success States */
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #6A0DAD;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 2s linear infinite;
            margin: 0 auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            display: none;
        }
        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            display: none;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .filter-buttons {
                flex-direction: column;
            }
            
            .filter-btn {
                width: 100%;
            }
            
            .event-actions {
                flex-direction: column;
            }
            
            .action-btn {
                width: 100%;
                text-align: center;
            }
            
            .calendar-view {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo-text">
            <span>GBV</span>
            <span>SAFE</span>
            <span>CORNER</span>
        </div>
        <p>Events & Awareness Marches</p>
    </div>

    <!-- Navigation auto-loaded here -->

    <div class="content-section">
        <h2>üìÖ Upcoming Events & Marches</h2>
        <p>Join community events, awareness campaigns, and support gatherings. Together we can create change and support survivors.</p>

        <div class="filter-buttons">
            <button class="filter-btn active" onclick="filterEvents('all')">All Events</button>
            <button class="filter-btn" onclick="filterEvents('upcoming')">Upcoming</button>
            <button class="filter-btn" onclick="filterEvents('marches')">Marches</button>
            <button class="filter-btn" onclick="filterEvents('workshops')">Workshops</button>
            <button class="filter-btn" onclick="filterEvents('vigils')">Vigils</button>
            <button class="filter-btn" onclick="filterEvents('virtual')">Virtual Events</button>
        </div>

        <div class="loading" id="loadingEvents">
            <div class="spinner"></div>
            <p>Loading events...</p>
        </div>

        <div class="success-message" id="successMessage">
            ‚úÖ Thank you! Your event has been submitted for review.
        </div>

        <div class="error-message" id="errorMessage">
            ‚ùå There was an error submitting your event. Please try again.
        </div>

        <!-- Sample Events -->
        <div class="event-card upcoming" data-categories="upcoming marches physical">
            <span class="event-badge badge-upcoming">UPCOMING</span>
            <h3>üéóÔ∏è 16 Days of Activism March</h3>
            <p><strong>Date:</strong> November 25, 2024 ‚Ä¢ 10:00 AM</p>
            <p><strong>Location:</strong> Church Square, Pretoria</p>
            <p><strong>Type:</strong> Peaceful March & Awareness Campaign</p>
            <p><strong>Description:</strong> Join us for the annual 16 Days of Activism against Gender-Based Violence march. We'll walk together to raise awareness and demand action against GBV in our communities.</p>
            <p><strong>Organizer:</strong> GBV Action Collective</p>
            <div class="event-actions">
                <button class="action-btn" onclick="rsvpToEvent('16 Days March')">üìù RSVP</button>
                <button class="action-btn" onclick="shareEvent('16 Days March')">üì§ Share</button>
                <button class="action-btn" onclick="addToCalendar('16 Days March', '2024-11-25T10:00:00', 'Church Square, Pretoria')">üìÖ Add to Calendar</button>
            </div>
        </div>

        <div class="event-card upcoming" data-categories="upcoming workshops virtual">
            <span class="event-badge badge-upcoming">UPCOMING</span>
            <h3>üíú Survivor Support Workshop</h3>
            <p><strong>Date:</strong> December 2, 2024 ‚Ä¢ 6:00 PM</p>
            <p><strong>Location:</strong> Online (Zoom)</p>
            <p><strong>Type:</strong> Virtual Support Workshop</p>
            <p><strong>Description:</strong> A safe online space for survivors to connect, share experiences, and learn coping strategies. Facilitated by professional counselors.</p>
            <p><strong>Organizer:</strong> Healing Together Foundation</p>
            <div class="event-actions">
                <button class="action-btn" onclick="rsvpToEvent('Survivor Workshop')">üìù RSVP</button>
                <button class="action-btn" onclick="shareEvent('Survivor Workshop')">üì§ Share</button>
                <button class="action-btn" onclick="addToCalendar('Survivor Workshop', '2024-12-02T18:00:00', 'Online')">üìÖ Add to Calendar</button>
            </div>
        </div>

        <div class="event-card upcoming" data-categories="upcoming vigils physical">
            <span class="event-badge badge-upcoming">UPCOMING</span>
            <h3>üïØÔ∏è Candlelight Vigil for Survivors</h3>
            <p><strong>Date:</strong> December 10, 2024 ‚Ä¢ 7:00 PM</p>
            <p><strong>Location:</strong> Nelson Mandela Amphitheatre, Johannesburg</p>
            <p><strong>Type:</strong> Memorial Vigil</p>
            <p><strong>Description:</strong> Join us for a peaceful candlelight vigil to remember those we've lost to gender-based violence and to stand in solidarity with survivors.</p>
            <p><strong>Organizer:</strong> Remember Their Names Collective</p>
            <div class="event-actions">
                <button class="action-btn" onclick="rsvpToEvent('Candlelight Vigil')">üìù RSVP</button>
                <button class="action-btn" onclick="shareEvent('Candlelight Vigil')">üì§ Share</button>
                <button class="action-btn" onclick="addToCalendar('Candlelight Vigil', '2024-12-10T19:00:00', 'Nelson Mandela Amphitheatre, Johannesburg')">üìÖ Add to Calendar</button>
            </div>
        </div>

        <div class="event-card past" data-categories="past workshops physical">
            <span class="event-badge badge-past">PAST EVENT</span>
            <h3>üõ°Ô∏è Safety Planning Workshop</h3>
            <p><strong>Date:</strong> October 15, 2024 ‚Ä¢ 2:00 PM</p>
            <p><strong>Location:</strong> Community Center, Cape Town</p>
            <p><strong>Type:</strong> Educational Workshop</p>
            <p><strong>Description:</strong> Learned practical safety planning strategies and connected with local support services.</p>
            <p><strong>Organizer:</strong> Safe Spaces Initiative</p>
            <div class="event-actions">
                <button class="action-btn" onclick="requestWorkshopMaterials()">üìö Request Materials</button>
            </div>
        </div>
    </div>

    <div class="organize-box">
        <h3>üì¢ Organize an Event in Your Community</h3>
        <p>Planning a march, vigil, workshop, or awareness event? Submit your event details and we'll help promote it to our community.</p>
        
        <button class="submit-btn" onclick="toggleEventForm()">+ Add Your Event</button>

        <div class="event-form" id="eventForm" style="display: none;">
            <h4>Event Submission Form</h4>
            <form id="eventSubmissionForm">
                <div class="form-group">
                    <label for="eventName">Event Name *</label>
                    <input type="text" id="eventName" name="eventName" required placeholder="e.g., Community March Against GBV">
                </div>

                <div class="form-group">
                    <label for="eventType">Event Type *</label>
                    <select id="eventType" name="eventType" required>
                        <option value="">Select type...</option>
                        <option value="march">March/Protest</option>
                        <option value="vigil">Vigil/Memorial</option>
                        <option value="workshop">Workshop/Training</option>
                        <option value="support_group">Support Group</option>
                        <option value="awareness_campaign">Awareness Campaign</option>
                        <option value="fundraiser">Fundraiser</option>
                        <option value="other">Other</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="eventDate">Event Date *</label>
                    <input type="date" id="eventDate" name="eventDate" required>
                </div>

                <div class="form-group">
                    <label for="eventTime">Event Time *</label>
                    <input type="time" id="eventTime" name="eventTime" required>
                </div>

                <div class="form-group">
                    <label for="eventLocation">Location *</label>
                    <input type="text" id="eventLocation" name="eventLocation" required placeholder="e.g., City Hall, Johannesburg or Online">
                </div>

                <div class="form-group">
                    <label for="eventDescription">Event Description *</label>
                    <textarea id="eventDescription" name="eventDescription" rows="4" required placeholder="Describe your event, its purpose, and what attendees can expect..."></textarea>
                </div>

                <div class="form-group">
                    <label for="organizerName">Organizer/Organization *</label>
                    <input type="text" id="organizerName" name="organizerName" required placeholder="Your name or organization">
                </div>

                <div class="form-group">
                    <label for="organizerContact">Contact Information *</label>
                    <input type="text" id="organizerContact" name="organizerContact" required placeholder="Email or phone number (will not be published)">
                </div>

                <div class="form-group">
                    <label for="expectedAttendance">Expected Attendance</label>
                    <input type="number" id="expectedAttendance" name="expectedAttendance" placeholder="Approximate number of attendees">
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" id="safetyPlan" name="safetyPlan" required>
                        I have a safety plan for this event *
                    </label>
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" id="consent" name="consent" required>
                        I agree to the terms and understand this event will be publicly listed *
                    </label>
                </div>

                <button type="submit" class="submit-btn">Submit Event for Review</button>
            </form>
        </div>

        <div style="margin-top: 20px; font-size: 14px; color: #666;">
            <p><strong>Event Guidelines:</strong></p>
            <ul style="text-align: left; display: inline-block;">
                <li>Events must promote GBV awareness, prevention, or survivor support</li>
                <li>Ensure adequate safety measures and planning</li>
                <li>Respectful and inclusive environment required</li>
                <li>Events are reviewed before publication</li>
            </ul>
        </div>
    </div>

    <div class="content-section">
        <h3>üóìÔ∏è Event Calendar</h3>
        <div class="calendar-view">
            <div class="calendar-month">
                <h4>November 2024</h4>
                <p><strong>25 Nov:</strong> 16 Days of Activism March</p>
                <p><strong>30 Nov:</strong> Youth Against GBV Forum</p>
            </div>
            <div class="calendar-month">
                <h4>December 2024</h4>
                <p><strong>2 Dec:</strong> Survivor Support Workshop</p>
                <p><strong>10 Dec:</strong> Candlelight Vigil</p>
                <p><strong>15 Dec:</strong> Community Safety Training</p>
            </div>
            <div class="calendar-month">
                <h4>January 2025</h4>
                <p><strong>12 Jan:</strong> New Year Support Circle</p>
                <p><strong>25 Jan:</strong> Legal Rights Workshop</p>
            </div>
        </div>
    </div>

    <script>
        // Enhanced Security & Privacy
        if (window.history.replaceState) {
            window.history.replaceState(null, null, window.location.pathname);
        }
        
        // Enhanced Emergency Exit
        document.addEventListener('DOMContentLoaded', function() {
            // Create emergency exit button
            const emergencyExit = document.createElement('div');
            emergencyExit.className = 'emergency-exit';
            emergencyExit.innerHTML = `
                <button onclick="emergencyRedirect()" 
                        title="Quickly leaves this site and clears data"
                        class="emergency-exit-btn">
                    üö® Quick Exit
                </button>
            `;
            document.body.appendChild(emergencyExit);

            // Enhanced emergency redirect
            window.emergencyRedirect = function() {
                // Clear sensitive data
                localStorage.removeItem('safetyPlanProgress');
                sessionStorage.clear();
                document.querySelectorAll('input, textarea').forEach(element => {
                    element.value = '';
                });
                // Redirect to safe page
                window.location.href = 'https://www.google.com/search?q=weather';
            };

            // Keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' || (e.ctrlKey && e.key === 'q')) {
                    emergencyRedirect();
                }
            });
            
            // Create Language Selector
            const languageSelector = document.createElement('select');
            languageSelector.id = 'languageSelector';
            languageSelector.innerHTML = `
                <option value="en">English</option>
                <option value="zu">Zulu</option>
                <option value="xh">Xhosa</option>
                <option value="af">Afrikaans</option>
            `;
            languageSelector.onchange = (e) => changeLanguage(e.target.value);
            document.body.appendChild(languageSelector);
            
            // Initialize language
            const savedLanguage = localStorage.getItem('preferredLanguage') || 'en';
            changeLanguage(savedLanguage);
            
            // Load events from Supabase
            loadEventsFromDatabase();
            
            // ANALYTICS TRACKING - INTEGRATED
            if (typeof analytics !== 'undefined') {
                analytics.trackPageView('events.html');
                analytics.trackFeatureUse('events_page_loaded');
            }
        });
        
        // Language Support
        const translations = {
            en: {
                'home': 'Home',
                'report': 'Report',
                'support': 'Support',
                'stories': 'Stories',
                'library': 'Resources',
                'community': 'Community',
                'events': 'Events',
                'about': 'About',
                'safety': 'Safety',
                'assessment': 'Risk Check',
                'education': 'Education',
                'login': 'Admin'
            },
            zu: {
                'home': 'Ikhaya',
                'report': 'Bika',
                'support': 'Usizo',
                'stories': 'Izindaba',
                'library': 'Izinsiza',
                'community': 'Umphakathi',
                'events': 'Imicimbi',
                'about': 'Mayelana',
                'safety': 'Ukuphepha',
                'assessment': 'Ukuhlola',
                'education': 'Imfundo',
                'login': 'Admin'
            },
            xh: {
                'home': 'Ekhaya',
                'report': 'Xela',
                'support': 'Uncedo',
                'stories': 'Iimbali',
                'library': 'Iindlela',
                'community': 'Uluntu',
                'events': 'Iivenkile',
                'about': 'Malunga',
                'safety': 'Ukhuseleko',
                'assessment': 'Uvavanyo',
                'education': 'Imfundo',
                'login': 'Admin'
            },
            af: {
                'home': 'Tuis',
                'report': 'Rapporteer',
                'support': 'Ondersteuning',
                'stories': 'Stories',
                'library': 'Hulpbronne',
                'community': 'Gemeenskap',
                'events': 'Gebeure',
                'about': 'Oor',
                'safety': 'Veiligheid',
                'assessment': 'Risiko',
                'education': 'Onderrig',
                'login': 'Admin'
            }
        };

        let currentLanguage = 'en';

        function changeLanguage(lang) {
            currentLanguage = lang;
            localStorage.setItem('preferredLanguage', lang);
            applyTranslations();
            updateLanguageSelector();
        }

        function applyTranslations() {
            const elements = document.querySelectorAll('[data-translate]');
            elements.forEach(element => {
                const key = element.getAttribute('data-translate');
                if (translations[currentLanguage] && translations[currentLanguage][key]) {
                    element.textContent = translations[currentLanguage][key];
                }
            });
        }

        function updateLanguageSelector() {
            const selector = document.getElementById('languageSelector');
            if (selector) {
                selector.value = currentLanguage;
            }
        }

        // Event Management Functions
        function filterEvents(category) {
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            const events = document.querySelectorAll('.event-card');
            events.forEach(event => {
                if (category === 'all') {
                    event.style.display = 'block';
                } else {
                    const categories = event.getAttribute('data-categories');
                    if (categories.includes(category)) {
                        event.style.display = 'block';
                    } else {
                        event.style.display = 'none';
                    }
                }
            });
            
            // ANALYTICS TRACKING
            if (typeof analytics !== 'undefined') {
                analytics.trackFeatureUse('events_filter_' + category);
            }
        }

        function toggleEventForm() {
            const form = document.getElementById('eventForm');
            form.style.display = form.style.display === 'none' ? 'block' : 'none';
            
            // ANALYTICS TRACKING
            if (typeof analytics !== 'undefined') {
                analytics.trackFeatureUse('event_form_toggled');
            }
        }

        function rsvpToEvent(eventName) {
            alert(`Thank you for your interest in "${eventName}". The organizer will contact you with more details.`);
            
            // ANALYTICS TRACKING
            if (typeof analytics !== 'undefined') {
                analytics.trackFeatureUse('event_rsvp');
                analytics.trackFeatureUse('rsvp_' + eventName.replace(/\s+/g, '_'));
            }
        }

        function shareEvent(eventName) {
            const shareText = `Join me at "${eventName}" - an important GBV awareness event. Learn more: ${window.location.href}`;
            
            if (navigator.share) {
                navigator.share({
                    title: eventName,
                    text: shareText,
                    url: window.location.href
                });
            } else {
                navigator.clipboard.writeText(shareText).then(() => {
                    alert('Event details copied to clipboard!');
                });
            }
            
            // ANALYTICS TRACKING
            if (typeof analytics !== 'undefined') {
                analytics.trackFeatureUse('event_shared');
            }
        }

        function addToCalendar(eventName, dateTime, location) {
            const eventDate = new Date(dateTime);
            const calendarUrl = `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(eventName)}&dates=${eventDate.toISOString().replace(/-|:|\.\d+/g, '')}&details=GBV Awareness Event&location=${encodeURIComponent(location)}`;
            
            window.open(calendarUrl, '_blank');
            
            // ANALYTICS TRACKING
            if (typeof analytics !== 'undefined') {
                analytics.trackFeatureUse('event_calendar_add');
            }
        }

        function requestWorkshopMaterials() {
            alert('Workshop materials request sent! We will email you the resources.');
            
            // ANALYTICS TRACKING
            if (typeof analytics !== 'undefined') {
                analytics.trackFeatureUse('workshop_materials_requested');
            }
        }

        async function loadEventsFromDatabase() {
            try {
                document.getElementById('loadingEvents').style.display = 'block';
                
                // This would typically fetch from Supabase
                // const events = await fetchFromSupabase('gbv_events', { 
                //     query: { 
                //         order: 'event_date.asc',
                //         is_public: 'eq.true'
                //     } 
                // });
                
                // For now, we'll use the static events in the HTML
                setTimeout(() => {
                    document.getElementById('loadingEvents').style.display = 'none';
                }, 1000);
                
            } catch (error) {
                console.error('Error loading events:', error);
                document.getElementById('loadingEvents').style.display = 'none';
            }
        }

        // Event Form Submission
        document.getElementById('eventSubmissionForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const eventData = {
                event_name: formData.get('eventName'),
                event_type: formData.get('eventType'),
                event_date: formData.get('eventDate'),
                event_time: formData.get('eventTime'),
                location: formData.get('eventLocation'),
                description: formData.get('eventDescription'),
                organizer_name: formData.get('organizerName'),
                organizer_contact: formData.get('organizerContact'),
                expected_attendance: formData.get('expectedAttendance'),
                safety_plan: formData.get('safetyPlan') === 'on',
                consent_given: formData.get('consent') === 'on',
                submitted_at: new Date().toISOString()
            };

            try {
                // Submit to Supabase
                // const response = await submitToSupabase('gbv_events', eventData);
                
                // For demo purposes, simulate success
                document.getElementById('successMessage').style.display = 'block';
                document.getElementById('eventSubmissionForm').reset();
                document.getElementById('eventForm').style.display = 'none';
                
                // ANALYTICS TRACKING
                if (typeof analytics !== 'undefined') {
                    analytics.trackFeatureUse('event_submitted');
                }
                
                setTimeout(() => {
                    document.getElementById('successMessage').style.display = 'none';
                }, 5000);
                
            } catch (error) {
                document.getElementById('errorMessage').style.display = 'block';
                setTimeout(() => {
                    document.getElementById('errorMessage').style.display = 'none';
                }, 5000);
            }
        });

        // Auto-set minimum date to today
        document.getElementById('eventDate').min = new Date().toISOString().split('T')[0];
    </script>
</body>
</html>
