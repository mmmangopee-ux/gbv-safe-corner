<!-- Replace the content-section div with this: -->
<div class="content-section">
    <h2>ðŸ’¬ Share Your Story Anonymously</h2>
    
    <div class="success-message" id="successMessage">
        Thank you for sharing your story. It has been submitted anonymously.
    </div>

    <form id="storyForm">
        <div class="form-group">
            <label for="storyTitle">Title (Optional)</label>
            <input type="text" id="storyTitle" name="storyTitle" placeholder="A title for your story">
        </div>

        <div class="form-group">
            <label for="storyContent">Your Story *</label>
            <textarea id="storyContent" name="storyContent" rows="8" placeholder="Share your experience, journey, or message of hope..." required></textarea>
        </div>

        <div class="form-group">
            <label>
                <input type="checkbox" id="shareAnonymously" name="shareAnonymously" checked>
                Share anonymously (recommended)
            </label>
        </div>

        <div class="form-group">
            <label>
                <input type="checkbox" id="allowComments" name="allowComments">
                Allow supportive comments from community
            </label>
        </div>

        <button type="submit" class="submit-btn">Share Your Story</button>
    </form>
</div>

<script>
    document.getElementById('storyForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const formData = new FormData(this);
        const storyData = {
            story_title: formData.get('storyTitle'),
            story_content: formData.get('storyContent'),
            share_anonymously: formData.get('shareAnonymously') === 'on',
            allow_comments: formData.get('allowComments') === 'on',
            ip_hash: getIpHash()
        };

        try {
            const response = await fetch(SUPABASE_URL + '/rest/v1/survivor_stories', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'apikey': SUPABASE_ANON_KEY,
                    'Authorization': 'Bearer ' + SUPABASE_ANON_KEY,
                    'Prefer': 'return=minimal'
                },
                body: JSON.stringify(storyData)
            });

            if (response.ok) {
                document.getElementById('successMessage').style.display = 'block';
                document.getElementById('storyForm').reset();
                setTimeout(() => {
                    document.getElementById('successMessage').style.display = 'none';
                }, 5000);
            } else {
                alert('Error submitting story. Please try again.');
            }
        } catch (error) {
            console.error('Error:', error);
            alert('Error submitting story. Please try again.');
        }
    });
</script>
