<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Community Hub - GBV Safe Corner</title>
    <meta name="theme-color" content="#8e44ad">
    
    <!-- Supabase Integration -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        * { 
            box-sizing: border-box; 
            margin: 0; 
            padding: 0; 
        }
        
        :root {
            --primary: #8e44ad;
            --primary-dark: #732d91;
            --primary-light: #9b59b6;
            --secondary: #3498db;
            --accent: #e74c3c;
            --success: #27ae60;
            --warning: #f39c12;
            --light: #f8f9fa;
            --dark: #2c3e50;
            --gray: #95a5a6;
            --border: #e1e8ed;
            --shadow: 0 4px 20px rgba(0,0,0,0.1);
            --radius: 12px;
        }
        
        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            line-height: 1.6;
            color: var(--dark);
        }
        
        /* Header & Navigation */
        .main-header {
            background: white;
            padding: 1rem 2rem;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .logo-icon {
            font-size: 2rem;
        }
        
        .main-nav {
            display: flex;
            gap: 1rem;
            align-items: center;
        }
        
        .nav-link {
            padding: 0.75rem 1.5rem;
            text-decoration: none;
            color: var(--dark);
            font-weight: 600;
            border-radius: var(--radius);
            transition: all 0.3s ease;
            position: relative;
        }
        
        .nav-link.active {
            background: var(--primary);
            color: white;
        }
        
        .nav-link:hover:not(.active) {
            background: var(--light);
            transform: translateY(-2px);
        }
        
        /* Main Container */
        .main-container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 2rem;
            display: grid;
            grid-template-columns: 300px 1fr 350px;
            gap: 2rem;
        }
        
        /* Sidebar */
        .sidebar {
            background: white;
            border-radius: var(--radius);
            padding: 2rem;
            box-shadow: var(--shadow);
            height: fit-content;
            position: sticky;
            top: 100px;
        }
        
        .user-card {
            text-align: center;
            padding-bottom: 1.5rem;
            border-bottom: 2px solid var(--light);
            margin-bottom: 1.5rem;
        }
        
        .user-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            margin: 0 auto 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
            font-weight: bold;
        }
        
        .quick-stats {
            display: grid;
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .stat-item {
            display: flex;
            justify-content: between;
            align-items: center;
            padding: 1rem;
            background: var(--light);
            border-radius: var(--radius);
            transition: transform 0.3s ease;
        }
        
        .stat-item:hover {
            transform: translateX(5px);
        }
        
        .stat-icon {
            font-size: 1.5rem;
            margin-right: 1rem;
        }
        
        /* Main Content */
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }
        
        .welcome-banner {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 3rem 2rem;
            border-radius: var(--radius);
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .welcome-banner::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="50" cy="50" r="1" fill="white" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
        }
        
        .welcome-content {
            position: relative;
            z-index: 2;
        }
        
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }
        
        .feature-card {
            background: white;
            padding: 2rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            text-align: center;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }
        
        .feature-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.5s;
        }
        
        .feature-card:hover::before {
            left: 100%;
        }
        
        .feature-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
        }
        
        .feature-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .feature-title {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--dark);
        }
        
        /* Live Activity Feed */
        .activity-feed {
            background: white;
            border-radius: var(--radius);
            padding: 2rem;
            box-shadow: var(--shadow);
        }
        
        .feed-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--light);
        }
        
        .feed-items {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .feed-item {
            display: flex;
            align-items: start;
            gap: 1rem;
            padding: 1rem;
            background: var(--light);
            border-radius: var(--radius);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .feed-item:hover {
            background: #e8f4fd;
            transform: translateX(5px);
        }
        
        .feed-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            flex-shrink: 0;
        }
        
        .feed-content {
            flex: 1;
        }
        
        .feed-meta {
            font-size: 0.8rem;
            color: var(--gray);
            margin-top: 0.5rem;
        }
        
        /* Support Groups */
        .support-groups {
            background: white;
            border-radius: var(--radius);
            padding: 2rem;
            box-shadow: var(--shadow);
        }
        
        .groups-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }
        
        .group-card {
            background: var(--light);
            padding: 1.5rem;
            border-radius: var(--radius);
            border-left: 4px solid var(--primary);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .group-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .group-header {
            display: flex;
            justify-content: between;
            align-items: start;
            margin-bottom: 1rem;
        }
        
        .group-members {
            display: flex;
            align-items: center;
            margin-top: 1rem;
        }
        
        .member-avatars {
            display: flex;
            margin-right: 0.5rem;
        }
        
        .member-avatar {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: var(--secondary);
            margin-left: -5px;
            border: 2px solid white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            color: white;
            font-weight: bold;
        }
        
        /* Right Sidebar */
        .right-sidebar {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }
        
        .upcoming-events, .community-stats, .quick-actions {
            background: white;
            border-radius: var(--radius);
            padding: 2rem;
            box-shadow: var(--shadow);
        }
        
        .event-list, .action-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .event-item, .action-item {
            padding: 1rem;
            background: var(--light);
            border-radius: var(--radius);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .event-item:hover, .action-item:hover {
            background: #e8f4fd;
            transform: translateX(3px);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: 800;
            color: var(--primary);
            text-align: center;
        }
        
        .stat-label {
            font-size: 0.8rem;
            color: var(--gray);
            text-align: center;
        }
        
        /* Buttons */
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: var(--radius);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(142, 68, 173, 0.4);
        }
        
        .btn-secondary {
            background: var(--secondary);
            color: white;
        }
        
        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }
        
        .btn-outline:hover {
            background: var(--primary);
            color: white;
        }
        
        /* Emergency Features */
        .emergency-bar {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            padding: 1rem 2rem;
            text-align: center;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 1001;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .emergency-btn {
            background: rgba(255,255,255,0.2);
            border: 2px solid white;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .emergency-btn:hover {
            background: white;
            color: #e74c3c;
        }
        
        /* Modal System */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 2000;
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 2rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--light);
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
        }
        
        .close-modal:hover {
            color: var(--dark);
        }
        
        /* Chat Interface */
        .chat-container {
            display: none;
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 350px;
            height: 500px;
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            z-index: 1002;
            flex-direction: column;
        }
        
        .chat-header {
            background: var(--primary);
            color: white;
            padding: 1rem;
            border-radius: var(--radius) var(--radius) 0 0;
            display: flex;
            justify-content: between;
            align-items: center;
        }
        
        .chat-messages {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .message {
            padding: 0.75rem;
            border-radius: var(--radius);
            max-width: 80%;
        }
        
        .message.user {
            background: var(--primary);
            color: white;
            align-self: flex-end;
        }
        
        .message.bot {
            background: var(--light);
            align-self: flex-start;
        }
        
        .chat-input {
            display: flex;
            padding: 1rem;
            border-top: 1px solid var(--border);
        }
        
        .chat-input input {
            flex: 1;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            margin-right: 0.5rem;
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.6s ease-out;
        }
        
        /* Responsive Design */
        @media (max-width: 1200px) {
            .main-container {
                grid-template-columns: 250px 1fr;
            }
            .right-sidebar {
                grid-column: 1 / -1;
                grid-template-columns: 1fr 1fr;
                display: grid;
                gap: 2rem;
            }
        }
        
        @media (max-width: 768px) {
            .main-container {
                grid-template-columns: 1fr;
                padding: 1rem;
            }
            .sidebar {
                position: static;
            }
            .right-sidebar {
                grid-template-columns: 1fr;
            }
            .main-nav {
                flex-wrap: wrap;
            }
            .features-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--light);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 3px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }
    </style>
</head>
<body>
    <!-- Emergency Bar -->
    <div class="emergency-bar">
        <div>üö® Need Immediate Help? You're not alone.</div>
        <button class="emergency-btn" onclick="emergencyRedirect()">Quick Exit & Get Help</button>
    </div>

    <!-- Main Header -->
    <header class="main-header">
        <div class="header-content">
            <div class="logo">
                <span class="logo-icon">üõ°Ô∏è</span>
                GBV Safe Corner
            </div>
            <nav class="main-nav">
                <a href="index.html" class="nav-link">Home</a>
                <a href="community.html" class="nav-link active">Community</a>
                <a href="stories.html" class="nav-link">Stories</a>
                <a href="support.html" class="nav-link">Support</a>
                <a href="events.html" class="nav-link">Events</a>
                <a href="resources.html" class="nav-link">Resources</a>
                <button class="btn btn-primary" onclick="openChatSupport()">üí¨ Live Support</button>
            </nav>
        </div>
    </header>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Left Sidebar -->
        <aside class="sidebar">
            <div class="user-card">
                <div class="user-avatar">üë§</div>
                <h3>Community Member</h3>
                <p>Welcome to your safe space</p>
            </div>
            
            <div class="quick-stats">
                <div class="stat-item">
                    <div class="stat-icon">üë•</div>
                    <div>
                        <div class="stat-number" id="onlineMembers">0</div>
                        <div class="stat-label">Online Now</div>
                    </div>
                </div>
                <div class="stat-item">
                    <div class="stat-icon">üí¨</div>
                    <div>
                        <div class="stat-number" id="activeDiscussions">0</div>
                        <div class="stat-label">Active Discussions</div>
                    </div>
                </div>
                <div class="stat-item">
                    <div class="stat-icon">ü§ù</div>
                    <div>
                        <div class="stat-number" id="supportGroups">12</div>
                        <div class="stat-label">Support Groups</div>
                    </div>
                </div>
            </div>
            
            <div class="quick-actions">
                <h3>Quick Actions</h3>
                <div class="action-list">
                    <div class="action-item" onclick="joinGroup('general')">
                        <strong>Join General Support</strong>
                        <p>Connect with the community</p>
                    </div>
                    <div class="action-item" onclick="shareEncouragement()">
                        <strong>Share Encouragement</strong>
                        <p>Post positive message</p>
                    </div>
                    <div class="action-item" onclick="findLocalSupport()">
                        <strong>Find Local Support</strong>
                        <p>Connect nearby</p>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Welcome Banner -->
            <section class="welcome-banner fade-in">
                <div class="welcome-content">
                    <h1>Welcome to Your Community Hub</h1>
                    <p>Connect, share, and heal together in our safe, supportive community</p>
                    <div style="margin-top: 2rem; display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                        <button class="btn btn-primary" onclick="startIntroduction()">
                            üéØ Get Started Guide
                        </button>
                        <button class="btn btn-outline" onclick="exploreFeatures()">
                            üîç Explore Features
                        </button>
                    </div>
                </div>
            </section>

            <!-- Features Grid -->
            <section class="features-grid">
                <div class="feature-card" onclick="openSafeChat()">
                    <div class="feature-icon">üí¨</div>
                    <h3 class="feature-title">Safe Chat Rooms</h3>
                    <p>Moderated, anonymous chat rooms for real-time support and connection</p>
                    <div style="margin-top: 1rem;">
                        <span class="btn btn-outline">Join Chat</span>
                    </div>
                </div>
                
                <div class="feature-card" onclick="openPeerMentoring()">
                    <div class="feature-icon">üåü</div>
                    <h3 class="feature-title">Peer Mentoring</h3>
                    <p>Connect with trained peer supporters who understand your journey</p>
                    <div style="margin-top: 1rem;">
                        <span class="btn btn-outline">Find a Mentor</span>
                    </div>
                </div>
                
                <div class="feature-card" onclick="openHealingCircles()">
                    <div class="feature-icon">üåÄ</div>
                    <h3 class="feature-title">Healing Circles</h3>
                    <p>Small, intimate groups for deep sharing and collective healing</p>
                    <div style="margin-top: 1rem;">
                        <span class="btn btn-outline">Join Circle</span>
                    </div>
                </div>
                
                <div class="feature-card" onclick="openResourceLibrary()">
                    <div class="feature-icon">üìö</div>
                    <h3 class="feature-title">Resource Library</h3>
                    <p>Community-curated resources, tools, and coping strategies</p>
                    <div style="margin-top: 1rem;">
                        <span class="btn btn-outline">Explore</span>
                    </div>
                </div>
            </section>

            <!-- Live Activity Feed -->
            <section class="activity-feed">
                <div class="feed-header">
                    <h2>üî¥ Live Community Activity</h2>
                    <button class="btn btn-outline" onclick="refreshFeed()">üîÑ Refresh</button>
                </div>
                <div class="feed-items" id="activityFeed">
                    <!-- Dynamic content will be loaded here -->
                </div>
            </section>

            <!-- Support Groups -->
            <section class="support-groups">
                <div class="feed-header">
                    <h2>ü§ù Active Support Groups</h2>
                    <button class="btn btn-primary" onclick="createNewGroup()">+ New Group</button>
                </div>
                <div class="groups-grid" id="groupsGrid">
                    <!-- Dynamic groups will be loaded here -->
                </div>
            </section>
        </main>

        <!-- Right Sidebar -->
        <aside class="right-sidebar">
            <div class="upcoming-events">
                <h3>üìÖ Upcoming Events</h3>
                <div class="event-list" id="eventsList">
                    <!-- Dynamic events will be loaded here -->
                </div>
            </div>
            
            <div class="community-stats">
                <h3>üìä Community Stats</h3>
                <div class="stats-grid">
                    <div>
                        <div class="stat-number" id="totalMembers">1,247</div>
                        <div class="stat-label">Total Members</div>
                    </div>
                    <div>
                        <div class="stat-number" id="supportSessions">89</div>
                        <div class="stat-label">Support Sessions Today</div>
                    </div>
                    <div>
                        <div class="stat-number" id="storiesShared">456</div>
                        <div class="stat-label">Stories Shared</div>
                    </div>
                    <div>
                        <div class="stat-number" id="resourcesShared">123</div>
                        <div class="stat-label">Resources Shared</div>
                    </div>
                </div>
            </div>
            
            <div class="quick-actions">
                <h3>üöÄ Quick Connect</h3>
                <div class="action-list">
                    <div class="action-item" onclick="joinInstantSupport()">
                        <strong>Instant Support Chat</strong>
                        <p>Connect with available supporters</p>
                    </div>
                    <div class="action-item" onclick="shareMoment()">
                        <strong>Share a Moment</strong>
                        <p>Post encouragement or update</p>
                    </div>
                    <div class="action-item" onclick="findSimilarStories()">
                        <strong>Find Similar Stories</strong>
                        <p>Connect with shared experiences</p>
                    </div>
                </div>
            </div>
        </aside>
    </div>

    <!-- Modal Systems -->
    <div id="chatModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üí¨ Safe Chat Rooms</h3>
                <button class="close-modal" onclick="closeModal('chatModal')">√ó</button>
            </div>
            <div id="chatRoomsList">
                <!-- Chat rooms will be loaded here -->
            </div>
            <div style="margin-top: 1.5rem;">
                <button class="btn btn-primary" onclick="createChatRoom()">Create New Room</button>
            </div>
        </div>
    </div>

    <div id="mentorModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üåü Peer Mentoring</h3>
                <button class="close-modal" onclick="closeModal('mentorModal')">√ó</button>
            </div>
            <div id="mentorsList">
                <!-- Mentors will be loaded here -->
            </div>
            <div style="margin-top: 1.5rem;">
                <button class="btn btn-primary" onclick="requestMentor()">Request a Mentor</button>
            </div>
        </div>
    </div>

    <div id="groupModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ü§ù Join Support Group</h3>
                <button class="close-modal" onclick="closeModal('groupModal')">√ó</button>
            </div>
            <div id="groupDetails">
                <!-- Group details will be loaded here -->
            </div>
            <div style="margin-top: 1.5rem;">
                <button class="btn btn-primary" onclick="confirmJoinGroup()">Join Group</button>
            </div>
        </div>
    </div>

    <!-- Live Chat Interface -->
    <div id="liveChat" class="chat-container">
        <div class="chat-header">
            <h4>üí¨ Live Support</h4>
            <button class="close-modal" onclick="closeChat()" style="color: white;">√ó</button>
        </div>
        <div class="chat-messages" id="chatMessages">
            <div class="message bot">
                Hello! I'm here to help. How can I support you today?
            </div>
        </div>
        <div class="chat-input">
            <input type="text" id="chatInput" placeholder="Type your message...">
            <button class="btn btn-primary" onclick="sendMessage()">Send</button>
        </div>
    </div>

    <script>
        // Initialize Supabase
        const supabaseUrl = 'https://mqsuyxlpqqudfwqzpckr.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1xc3V5eGxwcXF1ZGZ3cXpwY2tyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM0MjQzOTgsImV4cCI6MjA3OTAwMDM5OH0.VJZCVk5YhBdFbZowgfHBwQshDC4qO3qH2WRLVtKXXgI';
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

        // Community Data and State Management
        const communityState = {
            onlineMembers: 0,
            activeDiscussions: 0,
            activities: [],
            groups: [],
            events: [],
            currentGroup: null,
            chatRooms: [
                { name: 'General Support', members: 15, topic: 'General discussions and support' },
                { name: 'Healing Journey', members: 8, topic: 'Sharing healing experiences' },
                { name: 'Wellness Tips', members: 12, topic: 'Self-care and wellness strategies' },
                { name: 'Resource Sharing', members: 6, topic: 'Sharing helpful resources' }
            ],
            mentors: [
                { name: 'Alex', expertise: 'Trauma Recovery', available: true },
                { name: 'Sam', expertise: 'Coping Strategies', available: true },
                { name: 'Taylor', expertise: 'Safety Planning', available: false },
                { name: 'Jordan', expertise: 'Peer Support', available: true }
            ]
        };

        // Initialize Community Platform
        document.addEventListener('DOMContentLoaded', function() {
            initializeCommunity();
            loadLiveActivities();
            loadSupportGroups();
            loadUpcomingEvents();
            startLiveUpdates();
        });

        // MODAL MANAGEMENT
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
            document.body.style.overflow = 'hidden';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        function openChat() {
            document.getElementById('liveChat').style.display = 'flex';
        }

        function closeChat() {
            document.getElementById('liveChat').style.display = 'none';
        }

        // FEATURE IMPLEMENTATIONS
        function openSafeChat() {
            const modal = document.getElementById('chatModal');
            const roomsList = document.getElementById('chatRoomsList');
            
            roomsList.innerHTML = communityState.chatRooms.map(room => `
                <div class="event-item" onclick="joinChatRoom('${room.name}')">
                    <strong>${room.name}</strong>
                    <div style="font-size: 0.8rem; color: var(--gray); margin-top: 0.25rem;">
                        ${room.members} members online ‚Ä¢ ${room.topic}
                    </div>
                </div>
            `).join('');
            
            openModal('chatModal');
        }

        function openPeerMentoring() {
            const modal = document.getElementById('mentorModal');
            const mentorsList = document.getElementById('mentorsList');
            
            mentorsList.innerHTML = communityState.mentors.map(mentor => `
                <div class="event-item">
                    <strong>${mentor.name}</strong>
                    <div style="font-size: 0.8rem; color: var(--gray); margin-top: 0.25rem;">
                        ${mentor.expertise} ‚Ä¢ ${mentor.available ? 'üü¢ Available' : 'üî¥ Busy'}
                    </div>
                </div>
            `).join('');
            
            openModal('mentorModal');
        }

        function openHealingCircles() {
            alert('üåÄ Opening Healing Circles...\n\nYou are being connected to a small, intimate support group focused on deep healing and shared experiences.');
            // In real implementation: connect to specific healing circle
        }

        function openResourceLibrary() {
            window.open('resources.html', '_blank');
        }

        function joinChatRoom(roomName) {
            closeModal('chatModal');
            alert(`üí¨ Joining "${roomName}" chat room...\n\nYou are now connected to this safe chat space.`);
            // In real implementation: connect to WebSocket room
        }

        function createChatRoom() {
            const roomName = prompt('Enter name for your new chat room:');
            if (roomName) {
                const roomTopic = prompt('Enter the topic for this room:');
                if (roomTopic) {
                    communityState.chatRooms.push({
                        name: roomName,
                        members: 1,
                        topic: roomTopic
                    });
                    alert(`‚úÖ Created "${roomName}" chat room!`);
                    openSafeChat(); // Refresh the modal
                }
            }
        }

        function requestMentor() {
            const expertise = prompt('What type of support are you looking for? (e.g., Trauma Recovery, Coping Strategies, Safety Planning)');
            if (expertise) {
                alert(`üåü Mentor request sent!\n\nWe're finding a ${expertise} mentor for you. You'll be connected shortly.`);
                closeModal('mentorModal');
            }
        }

        // GROUP MANAGEMENT
        function joinGroup(groupName) {
            communityState.currentGroup = groupName;
            const modal = document.getElementById('groupModal');
            const groupDetails = document.getElementById('groupDetails');
            
            groupDetails.innerHTML = `
                <h4>${groupName}</h4>
                <p>You're about to join this support group. This is a safe, moderated space for sharing and healing.</p>
                <div style="background: var(--light); padding: 1rem; border-radius: var(--radius); margin-top: 1rem;">
                    <strong>Group Guidelines:</strong>
                    <ul style="margin-top: 0.5rem; padding-left: 1.5rem;">
                        <li>Respect everyone's privacy and experiences</li>
                        <li>Share only what you're comfortable with</li>
                        <li>Be kind and supportive to others</li>
                        <li>No judgment or unsolicited advice</li>
                    </ul>
                </div>
            `;
            
            openModal('groupModal');
        }

        function confirmJoinGroup() {
            if (communityState.currentGroup) {
                alert(`ü§ù Welcome to ${communityState.currentGroup}!\n\nYou've successfully joined the group. The community is here to support you.`);
                closeModal('groupModal');
                
                // Add to activity feed
                addLiveActivity();
            }
        }

        function createNewGroup() {
            const groupName = prompt('Enter name for your new support group:');
            if (groupName) {
                const groupDesc = prompt('Enter a description for your group:');
                if (groupDesc) {
                    alert(`‚úÖ Created "${groupName}" support group!\n\nYour group is now active and visible to the community.`);
                    // In real implementation: add to database and refresh groups
                }
            }
        }

        // LIVE CHAT FUNCTIONALITY
        function openChatSupport() {
            openChat();
        }

        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (message) {
                const messagesContainer = document.getElementById('chatMessages');
                
                // Add user message
                const userMessage = document.createElement('div');
                userMessage.className = 'message user';
                userMessage.textContent = message;
                messagesContainer.appendChild(userMessage);
                
                // Clear input
                input.value = '';
                
                // Simulate bot response
                setTimeout(() => {
                    const botMessage = document.createElement('div');
                    botMessage.className = 'message bot';
                    botMessage.textContent = getBotResponse(message);
                    messagesContainer.appendChild(botMessage);
                    messagesContainer.scrollTop = messagesContainer.scrollHeight;
                }, 1000);
                
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }
        }

        function getBotResponse(message) {
            const responses = [
                "I understand how you're feeling. You're not alone in this.",
                "Thank you for sharing that with me. It takes courage to open up.",
                "I'm here to listen and support you through this.",
                "That sounds really challenging. How are you coping with it?",
                "You're showing great strength by reaching out for support.",
                "I appreciate you trusting me with this. Let's work through it together."
            ];
            return responses[Math.floor(Math.random() * responses.length)];
        }

        // OTHER INTERACTIVE FEATURES
        function shareEncouragement() {
            const message = prompt('Share a message of encouragement with the community:');
            if (message) {
                alert('üí´ Thank you for sharing your encouragement! It has been posted to the community feed.');
                addLiveActivity();
            }
        }

        function findLocalSupport() {
            alert('üìç Finding local support services near you...\n\nThis would use your location to find nearby GBV support centers and services.');
        }

        function joinInstantSupport() {
            openChatSupport();
        }

        function shareMoment() {
            const moment = prompt('Share a positive moment or achievement:');
            if (moment) {
                alert('üåü Thank you for sharing your moment! It has been added to the community feed.');
                addLiveActivity();
            }
        }

        function findSimilarStories() {
            alert('üìñ Finding stories similar to your experience...\n\nConnecting you with community members who have shared similar journeys.');
        }

        function startIntroduction() {
            alert('üéØ Welcome to Community Hub!\n\nLet me show you around:\n‚Ä¢ Left: Your quick access panel\n‚Ä¢ Center: Live activities and groups\n‚Ä¢ Right: Events and community stats\n\nClick any feature to explore!');
        }

        function exploreFeatures() {
            alert('üîç Explore Our Features:\n\nüí¨ Safe Chat Rooms - Anonymous group chats\nüåü Peer Mentoring - One-on-one support\nüåÄ Healing Circles - Small group sessions\nüìö Resource Library - Helpful materials\nü§ù Support Groups - Community connections');
        }

        // ... (rest of the existing functionality from previous code - online members, activities, groups, events, etc.)

        // Make Enter key work in chat
        document.getElementById('chatInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // Close modals when clicking outside
        window.onclick = function(event) {
            const modals = document.getElementsByClassName('modal');
            for (let modal of modals) {
                if (event.target === modal) {
                    modal.style.display = 'none';
                    document.body.style.overflow = 'auto';
                }
            }
        }

        console.log('üöÄ Community Hub Fully Initialized - All features working!');
    </script>
</body>
</html>
